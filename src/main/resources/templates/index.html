<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
<meta charset="ISO-8859-1">
<title>Demo Name Archiver</title>

<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
   <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">            
 
</head>
<style>
.navbar {
	background-color: #699;
}
</style>
<body>
	<!-- create navigation bar ( header)  -->
	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed"
					data-toggle="collapse" data-target="#navbar" aria-expanded="false"
					aria-controls="navbar">
					<span class="sr-only"></span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
		  <div class="navbar-header">
      <a class="navbar-brand" href="#"  style="color: #FFF;">Demo Name Archiver</a>
    </div>
    
				<a sec:authorize="isAuthenticated()" class="navbar-brand" href="#" th:href="@{/}"  style="color: #FFF;">Home</a>
			</div>
			<div id="navbar" class="collapse navbar-collapse">
				<ul class="nav navbar-nav navbar-right">
					<li sec:authorize="isAuthenticated()"><a th:href="@{/logout}"  style="color: #FFF;">Logout</a></li>
				</ul>
			</div>
		</div>
	</nav>

 <!-- 
 <nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="#" style="color: green">WebSiteName</a>
    </div>
    <ul class="nav navbar-nav">
      <li><a href="#">Page 1</a></li>
      <li><a href="#">Page 2</a></li>
    </ul>
    <form class="navbar-form navbar-left" action="/action_page.php">
      <div class="input-group">
        <input type="text" class="form-control" placeholder="Search" name="search">
        <div class="input-group-btn">
          <button class="btn btn-default" type="submit">
            <i class="glyphicon glyphicon-search"></i>
          </button>
        </div>
      </div>
    </form>
  </div>
</nav> -->
	<br><br><br><br>
	<div class="container">
		<div th:if="!${param.success}" class="alert alert-success">
			<strong>Success!</strong> Login Successful.
			<span sec:authentication="principal.username">User</span>
			<i><span sec:authentication="principal.authorities">Roles</span></i>
		</div>
		
					<div th:if="${param.successes}">
					<div class="alert alert-success">You've successfully registered
						</div>
				</div>
				<div th:if="${param.updateSuccess}">
					<div class="alert alert-success">You've successfully Updated
						</div>
				</div>
				<div th:if="${param.userwithThisEmailFoundError}">
					<div class="alert alert-danger">This User name is found in the Database Please Register with other Username
						</div>
				</div>
				
				<div th:if="${param.userNotFoundSuccess}">
					<div class="alert alert-danger"> User With this Id is not found
						</div>
				</div>
				
				<div th:if="${param.deleteSuccess}">
					<div class="alert alert-success"> User With this Id is Deleted
						</div>
				</div>
				
				<div th:if="${param.pwdChangedSuccess}">
					<div class="alert alert-success"> Password is changed successfully
						</div>
				</div>
				
			 <div th:if="${param.pwdNotMatch}">
					<div class="alert alert-success"> You entered incorrect old password
						</div>
				</div>
	
				
	  <div class="row">
		
		     <div class="row">
				<div class="col-md-3" th:if="${#lists.isEmpty(detail)}">
			<a href="/detail" class="btn btn-primary">View Detail</a>
		     </div>
		<h1 sec:authorize="hasAnyAuthority('Admin')" th:if="${ not#lists.isEmpty(listOfUsers)}" class="col-sm-3">Users List</h1>
				<div class="col-sm-3">
							<a href="/registration/change" class="btn btn-primary">Change Your Password</a>
						</div>
		
		</div>
			  <div class="row alert alert-info" th:if="${ not#lists.isEmpty(detail)}">
                         <div class="center"> My Detail</div>
					    <h4 class="col-md-3" th:text="${detail.firstName}"></h4>
					     <h4 class="col-md-3" th:text="${detail.lastName}"></h4>
					      <h4 class="col-md-3" sec:authentication="principal.username"></h4>
					     <a th:href="@{'/edit/' + ${detail.id}}" class="btn btn-success btn-sm">Edit</a>
				</div>
					
		
		<div th:if="${ not#lists.isEmpty(listOfUsers)}" class="row">
		<div class="col-sm-6" sec:authorize="hasAnyAuthority('Admin')">
			<a href="/registration" class="btn btn-primary">Add New User</a>
		</div>
		<div sec:authorize="hasAnyAuthority('Admin')" class="col-sm-4"> <form th:action="@{/}" method ="get">
		<!--  <input type="text" name="searchKey" /> -->
		  <!--  <input class="form-control me-2" name="searchKey" type="search" placeholder="Search" aria-label="Search">-->
		<!--  <button type="submit" class="btn btn-primary">Search</button> -->
		      <div class="input-group">
        <input type="text" class="form-control" placeholder="Search" name="searchKey">
        <div class="input-group-btn">
          <button class="btn btn-default" type="submit">
            <i class="glyphicon glyphicon-search"></i>
          </button>
        </div>
      </div>
        </form>
		</form> </div>
		</div>
		<div th:if="${#lists.isEmpty(listOfUsers)}">
					<div th:if="${#lists.isEmpty(detail)}" class="alert alert-danger"> Content Not found with this search
						</div>
				</div>
		<br>
		<table sec:authorize="hasAnyAuthority('Admin')"  th:if="${ not#lists.isEmpty(listOfUsers)}" class="table table-striped table-responsive  table-sm">
			<thead class="table-light">
				<tr>
					<th>First Name</th>
					<th>Last Name</th>
					<th>User Name</th>
					<th sec:authorize="hasAnyAuthority('Admin')">Action</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="user : ${listOfUsers}" >
					<td th:text="${user.firstName}"></td>
					<td th:text="${user.lastName}"></td>
					<td th:text="${user.email}"></td>

					<td>
						<div sec:authorize="hasAnyAuthority('Admin')" class="d-grid gap-2 d-md-block">
						<a th:href="@{'/edit/' + ${user.id}}" class="btn btn-success btn-sm">Edit</a>
						  <button th:id="@{'/delete/' + ${user.id}}" type="button" class="btn btn-danger btn-sm " data-toggle="modal" data-target="#myModal" onclick="handleDeletBtnClick(this)">Delete</button>
						
							
							 
						</div> &nbsp;&nbsp;&nbsp;
						
					<!-- <div sec:authorize="hasAnyAuthority('Admin')">
							
						</div> -->	
					</td>

				</tr>
			</tbody>
		</table>
	</div>
	
	<!-- <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />-->


  <!-- Modal -->
  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <p>Are you sure to delete the user?</p>
          <a id="deletHref" name="deletebtn" data-toggle="" class="btn btn-danger" data-target="#myModal">Delete</a>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">No</button>
        </div>
      </div>
      
    </div>
  </div>
  
  <script>
  function onclick(obj){
	  alert(obj.href)
  }
  function handleDeletBtnClick(obj){
	  document.getElementById('deletHref').href=obj.id;
  }
  </script>
  
</body>
</html>
